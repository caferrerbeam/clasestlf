<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gu√≠a de Implementaci√≥n del Transpilador RoboLang</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #333;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #1e3c72;
        }

        .section h2 {
            color: #1e3c72;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .section h3 {
            color: #2a5298;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .section h4 {
            color: #3b6ec9;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .thinking-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .thinking-title {
            font-weight: bold;
            color: #856404;
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        .example-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .example-title {
            font-weight: bold;
            color: #155724;
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        .warning-box {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .warning-title {
            font-weight: bold;
            color: #721c24;
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        .hint-box {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .hint-title {
            font-weight: bold;
            color: #0c5460;
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        .steps {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px solid #e9ecef;
        }

        .step {
            margin: 15px 0;
            padding-left: 30px;
            position: relative;
        }

        .step::before {
            content: "‚Üí";
            position: absolute;
            left: 0;
            color: #1e3c72;
            font-weight: bold;
            font-size: 1.3em;
        }

        pre {
            background: #2d2d2d !important;
            color: #f8f8f2 !important;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
            line-height: 1.5;
        }

        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #d63384;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border: 1px solid #dee2e6;
        }

        th {
            background: #1e3c72;
            color: white;
            font-weight: bold;
        }

        tr:nth-child(even) {
            background: #f8f9fa;
        }

        ul, ol {
            margin-left: 20px;
            margin-top: 10px;
        }

        li {
            margin: 8px 0;
        }

        .toc {
            background: #e7f3ff;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 2px solid #2a5298;
        }

        .toc h3 {
            color: #1e3c72;
            margin-bottom: 15px;
        }

        .toc ul {
            list-style: none;
            margin-left: 0;
        }

        .toc li {
            margin: 10px 0;
        }

        .toc a {
            color: #2a5298;
            text-decoration: none;
            transition: color 0.3s;
            font-size: 1.05em;
        }

        .toc a:hover {
            color: #1e3c72;
            text-decoration: underline;
        }

        .formula {
            background: white;
            padding: 15px;
            border: 2px dashed #2a5298;
            border-radius: 5px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            text-align: center;
            font-size: 1.1em;
        }

        .test-box {
            background: #e7e3ff;
            border-left: 4px solid #6f42c1;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .test-title {
            font-weight: bold;
            color: #4a2c7a;
            margin-bottom: 12px;
            font-size: 1.1em;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Gu√≠a de Implementaci√≥n del Transpilador</h1>
            <p>Aprende a construir el JavaScriptCodeGenerator para RoboLang</p>
        </header>

        <div class="content">
            <!-- Tabla de Contenidos -->
            <div class="toc">
                <h3>Contenidos</h3>
                <ul>
                    <li><a href="#introduccion">1. Introducci√≥n: ¬øQu√© es un Transpilador?</a></li>
                    <li><a href="#transpile">2. El M√©todo transpile(): Orquestando las 4 Fases</a></li>
                    <li><a href="#estructura">3. Estructura del JavaScriptCodeGenerator</a></li>
                    <li><a href="#program">4. Implementando visitProgram()</a></li>
                    <li><a href="#statements">5. Implementando Statements</a></li>
                    <li><a href="#commands">6. Implementando Commands</a></li>
                    <li><a href="#expressions">7. Implementando Expressions</a></li>
                    <li><a href="#values">8. Implementando Values y Literals</a></li>
                    <li><a href="#functions">9. Implementando Funciones (v3.0)</a></li>
                    <li><a href="#helpers">10. M√©todos Helper: Indentaci√≥n y Variables Aleatorias</a></li>
                    <li><a href="#checklist">11. Checklist de Implementaci√≥n</a></li>
                </ul>
            </div>

            <!-- 1. Introducci√≥n -->
            <div class="section" id="introduccion">
                <h2>1. Introducci√≥n: ¬øQu√© es un Transpilador?</h2>

                <p>
                    Un <strong>transpilador</strong> (tambi√©n llamado <em>source-to-source compiler</em>) es un programa que
                    traduce c√≥digo de un lenguaje de programaci√≥n a otro lenguaje de programaci√≥n de nivel similar.
                </p>

                <p>
                    En nuestro caso, el transpilador RoboLang traduce c√≥digo RoboLang a JavaScript ejecutable.
                </p>

                <div class="formula">
                    C√≥digo RoboLang ‚Üí [TRANSPILADOR] ‚Üí C√≥digo JavaScript
                </div>

                <h3>Componentes del Transpilador</h3>

                <table>
                    <tr>
                        <th>Componente</th>
                        <th>Funci√≥n</th>
                        <th>Entrada</th>
                        <th>Salida</th>
                    </tr>
                    <tr>
                        <td><strong>Transpiler</strong></td>
                        <td>Orquestador de las 4 fases</td>
                        <td>String (c√≥digo RoboLang)</td>
                        <td>TranspilationResult</td>
                    </tr>
                    <tr>
                        <td><strong>Lexer</strong></td>
                        <td>An√°lisis l√©xico</td>
                        <td>String</td>
                        <td>List&lt;Token&gt;</td>
                    </tr>
                    <tr>
                        <td><strong>Parser</strong></td>
                        <td>An√°lisis sint√°ctico</td>
                        <td>List&lt;Token&gt;</td>
                        <td>ProgramNode (AST)</td>
                    </tr>
                    <tr>
                        <td><strong>SemanticAnalyzer</strong></td>
                        <td>An√°lisis sem√°ntico</td>
                        <td>ProgramNode</td>
                        <td>SymbolTable</td>
                    </tr>
                    <tr>
                        <td><strong>JavaScriptCodeGenerator</strong></td>
                        <td>Generaci√≥n de c√≥digo</td>
                        <td>ProgramNode</td>
                        <td>String (JavaScript)</td>
                    </tr>
                </table>

                <div class="example-box">
                    <div class="example-title">Ejemplo Completo del Flujo</div>
                    <p><strong>Entrada (RoboLang):</strong></p>
                    <pre>REPEAT 3 {
    UP;
    RIGHT;
}</pre>
                    <p><strong>Fase 1 - Lexer ‚Üí Tokens:</strong></p>
                    <pre>[REPEAT, NUMBER(3), LEFT_BRACE, UP, SEMICOLON, RIGHT, SEMICOLON, RIGHT_BRACE]</pre>
                    <p><strong>Fase 2 - Parser ‚Üí AST:</strong></p>
                    <pre>ProgramNode
  ‚îî‚îÄ‚îÄ RepeatStatementNode(3)
      ‚îî‚îÄ‚îÄ StatementListNode
          ‚îú‚îÄ‚îÄ MovementCommandNode(UP)
          ‚îî‚îÄ‚îÄ MovementCommandNode(RIGHT)</pre>
                    <p><strong>Fase 3 - Semantic ‚Üí Symbol Table:</strong></p>
                    <pre>(vac√≠a, no hay variables en este ejemplo)</pre>
                    <p><strong>Fase 4 - CodeGen ‚Üí JavaScript:</strong></p>
                    <pre>const robot = RoboLangRuntime.getRobot();

async function main() {
    for (let a1b2c3 = 0; a1b2c3 < 3; a1b2c3++) {
        await robot.moveUp();
        await robot.moveRight();
    }
}

main().catch(err => console.error('Error:', err));</pre>
                </div>
            </div>

            <!-- 2. El M√©todo transpile() -->
            <div class="section" id="transpile">
                <h2>2. El M√©todo transpile(): Orquestando las 4 Fases</h2>

                <p>
                    El m√©todo <code>transpile()</code> en la clase <code>Transpiler</code> es el punto de entrada principal.
                    Coordina las 4 fases del compilador de forma secuencial.
                </p>

                <h3>Estructura del M√©todo transpile()</h3>

                <pre>public TranspilationResult transpile(String roboLangCode) {
    TranspilationResult result = new TranspilationResult();

    try {
        // Fase 1: An√°lisis L√©xico
        result.addPhaseLog("Phase 1: Lexical Analysis");
        lastTokens = lexer.tokenize(roboLangCode);
        result.addPhaseLog("  ‚úì Tokenized: " + lastTokens.size() + " tokens");

        // Fase 2: An√°lisis Sint√°ctico
        result.addPhaseLog("Phase 2: Syntactic Analysis");
        lastAST = parser.parse(lastTokens);
        result.addPhaseLog("  ‚úì AST constructed successfully");

        // Fase 3: An√°lisis Sem√°ntico
        result.addPhaseLog("Phase 3: Semantic Analysis");
        lastSymbolTable = semanticAnalyzer.analyze(lastAST);
        result.addPhaseLog("  ‚úì Symbol table: " + lastSymbolTable.size() + " symbols");

        // Verificar errores sem√°nticos
        if (lastSymbolTable.hasErrors()) {
            result.setSuccess(false);
            for (String error : lastSymbolTable.getErrors()) {
                result.addError(error);
            }
            return result;
        }

        // Fase 4: Generaci√≥n de C√≥digo
        result.addPhaseLog("Phase 4: Code Generation");
        String jsCode = codeGenerator.generate(lastAST);
        result.addPhaseLog("  ‚úì JavaScript generated");
        result.setJavaScriptCode(jsCode);

        result.setSuccess(true);
        return result;

    } catch (Exception e) {
        result.setSuccess(false);
        result.setErrorMessage("Transpilation failed: " + e.getMessage());
        return result;
    }
}</pre>

                <div class="thinking-box">
                    <div class="thinking-title">Puntos Clave del M√©todo transpile()</div>
                    <ol>
                        <li><strong>Secuencialidad:</strong> Cada fase depende del resultado de la anterior</li>
                        <li><strong>Manejo de Errores:</strong> Si una fase falla, el proceso se detiene</li>
                        <li><strong>Logging:</strong> Cada fase registra su progreso en el resultado</li>
                        <li><strong>Validaci√≥n Sem√°ntica:</strong> Verifica errores antes de generar c√≥digo</li>
                        <li><strong>Encapsulaci√≥n:</strong> El resultado se encapsula en TranspilationResult</li>
                    </ol>
                </div>

                <h3>¬øPor qu√© separar en 4 fases?</h3>

                <table>
                    <tr>
                        <th>Ventaja</th>
                        <th>Explicaci√≥n</th>
                    </tr>
                    <tr>
                        <td><strong>Modularidad</strong></td>
                        <td>Cada fase tiene una responsabilidad clara y √∫nica</td>
                    </tr>
                    <tr>
                        <td><strong>Debugging</strong></td>
                        <td>Puedes inspeccionar la salida de cada fase independientemente</td>
                    </tr>
                    <tr>
                        <td><strong>Reutilizaci√≥n</strong></td>
                        <td>El Lexer y Parser pueden usarse sin CodeGen (ej: linters)</td>
                    </tr>
                    <tr>
                        <td><strong>Testing</strong></td>
                        <td>Puedes testear cada fase de forma aislada</td>
                    </tr>
                    <tr>
                        <td><strong>Mantenibilidad</strong></td>
                        <td>Cambios en una fase no afectan a las dem√°s</td>
                    </tr>
                </table>
            </div>

            <!-- 3. Estructura del JavaScriptCodeGenerator -->
            <div class="section" id="estructura">
                <h2>3. Estructura del JavaScriptCodeGenerator</h2>

                <p>
                    El <code>JavaScriptCodeGenerator</code> implementa el patr√≥n <strong>Visitor</strong> para recorrer el AST
                    y generar c√≥digo JavaScript. Cada nodo del AST tiene un m√©todo <code>visit</code> correspondiente.
                </p>

                <h3>Variables de Estado Importantes</h3>

                <pre>public class JavaScriptCodeGenerator implements ASTVisitor&lt;String&gt; {

    // Control de indentaci√≥n
    private int indentLevel = 0;

    // Generaci√≥n de variables aleatorias para loops
    private Random random;
    private Set&lt;String&gt; usedVariableNames;
}</pre>

                <div class="thinking-box">
                    <div class="thinking-title">¬øPor qu√© necesitamos estas variables?</div>
                    <ul>
                        <li><strong>indentLevel:</strong> El c√≥digo JavaScript debe estar bien indentado para ser legible</li>
                        <li><strong>usedVariableNames:</strong> Evita colisiones de nombres en loops anidados</li>
                    </ul>
                    <p style="margin-top: 10px;">
                        <strong>Nota:</strong> ¬°Eso es todo! Solo necesitas estas 3 variables de estado. Simple y directo.
                    </p>
                </div>

                <h3>M√©todo generate(): Punto de Entrada</h3>

                <pre>public String generate(ProgramNode program) {
    // 1. Resetear todo el estado
    indentLevel = 0;
    usedVariableNames.clear();

    // 2. Iniciar el recorrido del AST
    return program.accept(this);
}</pre>

                <div class="warning-box">
                    <div class="warning-title">IMPORTANTE: Siempre Resetear el Estado</div>
                    <p>
                        Antes de generar c√≥digo, <strong>debes resetear todas las variables de estado</strong>.
                        Si no lo haces, generar c√≥digo m√∫ltiples veces dar√° resultados incorrectos.
                    </p>
                    <p>
                        Ejemplo: Si no reseteas <code>usedVariableNames</code>, el segundo programa tendr√°
                        variables de loop que empiezan donde termin√≥ el primer programa.
                    </p>
                </div>

                <h3>Organizaci√≥n de los M√©todos Visitor</h3>

                <p>Los 27 m√©todos visitor se organizan en categor√≠as:</p>

                <table>
                    <tr>
                        <th>Categor√≠a</th>
                        <th>M√©todos</th>
                        <th>Cantidad</th>
                    </tr>
                    <tr>
                        <td><strong>Program y Estructura</strong></td>
                        <td>visitProgram</td>
                        <td>1</td>
                    </tr>
                    <tr>
                        <td><strong>Statements</strong></td>
                        <td>visitStatement, visitStatementList, visitStatementBlock, visitRepeatStatement, visitIfStatement, visitWhileStatement, visitVariableDeclaration, visitAssignment</td>
                        <td>8</td>
                    </tr>
                    <tr>
                        <td><strong>Funciones</strong></td>
                        <td>visitFunctionDeclaration, visitMainFunction, visitParameter, visitReturnStatement, visitFunctionCall</td>
                        <td>5</td>
                    </tr>
                    <tr>
                        <td><strong>Commands</strong></td>
                        <td>visitSimpleCommand, visitMovementCommand, visitPenCommand</td>
                        <td>3</td>
                    </tr>
                    <tr>
                        <td><strong>Expressions</strong></td>
                        <td>visitCondition, visitOrExpression, visitAndExpression, visitNotExpression, visitPrimaryExpression, visitComparisonExpression, visitComparisonOperator</td>
                        <td>7</td>
                    </tr>
                    <tr>
                        <td><strong>Values y Literals</strong></td>
                        <td>visitValue, visitSensor, visitNumericSensor, visitBooleanSensor, visitNumber, visitDigit, visitBoolean, visitIdentifier</td>
                        <td>8</td>
                    </tr>
                </table>
            </div>

            <!-- 4. visitProgram() -->
            <div class="section" id="program">
                <h2>4. Implementando visitProgram()</h2>

                <p>
                    <code>visitProgram()</code> es el m√©todo m√°s importante porque genera la estructura completa del programa JavaScript.
                </p>

                <h3>Estructura del C√≥digo JavaScript Generado</h3>

                <div class="steps">
                    <div class="step"><strong>Header:</strong> Comentarios indicando que es c√≥digo generado</div>
                    <div class="step"><strong>Robot instance:</strong> <code>const robot = RoboLangRuntime.getRobot();</code></div>
                    <div class="step"><strong>Funciones definidas:</strong> Todas las funciones FUNCTION</div>
                    <div class="step"><strong>Funci√≥n main:</strong> El punto de entrada MAIN</div>
                    <div class="step"><strong>Ejecuci√≥n:</strong> <code>main().catch(...)</code></div>
                </div>

                <div class="thinking-box">
                    <div class="thinking-title">Proceso de Pensamiento para visitProgram()</div>
                    <ol>
                        <li><strong>¬øQu√© informaci√≥n tengo?</strong>
                            <ul>
                                <li>ProgramNode contiene: functions, mainFunction, statementList</li>
                            </ul>
                        </li>
                        <li><strong>¬øQu√© debo generar?</strong>
                            <ul>
                                <li>Un programa JavaScript completo que pueda ejecutarse</li>
                            </ul>
                        </li>
                        <li><strong>¬øEn qu√© orden?</strong>
                            <ul>
                                <li>Primero el header y la instancia del robot</li>
                                <li>Luego generar todas las funciones FUNCTION directamente</li>
                                <li>Despu√©s generar la funci√≥n main() directamente</li>
                                <li>Finalmente agregar la llamada a main()</li>
                            </ul>
                        </li>
                        <li><strong>¬øQu√© casos especiales debo manejar?</strong>
                            <ul>
                                <li>Programa sin MAIN expl√≠cito (v2.0 vs v3.0)</li>
                                <li>Programa solo con funciones (sin statements sueltos)</li>
                            </ul>
                        </li>
                    </ol>
                </div>

                <h3>Pasos para Implementar visitProgram()</h3>

                <div class="steps">
                    <div class="step">
                        <strong>Paso 1:</strong> Crear un StringBuilder para acumular el c√≥digo
                    </div>
                    <div class="step">
                        <strong>Paso 2:</strong> Agregar el header con comentarios
                    </div>
                    <div class="step">
                        <strong>Paso 3:</strong> Agregar <code>const robot = RoboLangRuntime.getRobot();\n\n</code>
                    </div>
                    <div class="step">
                        <strong>Paso 4:</strong> Procesar todas las funciones (si existen)
                        <ul>
                            <li>Recorrer <code>node.getFunctions()</code></li>
                            <li>Para cada funci√≥n, llamar <code>String funcCode = function.accept(this)</code></li>
                            <li>Agregar el c√≥digo retornado al StringBuilder principal</li>
                        </ul>
                    </div>
                    <div class="step">
                        <strong>Paso 5:</strong> Procesar MAIN (si existe)
                        <ul>
                            <li>Verificar si <code>node.getMainFunction() != null</code></li>
                            <li>Si existe, llamar <code>String mainCode = node.getMainFunction().accept(this)</code></li>
                            <li>Agregar el c√≥digo retornado al StringBuilder</li>
                        </ul>
                    </div>
                    <div class="step">
                        <strong>Paso 6:</strong> Si no hay MAIN, crear uno con los statements sueltos
                        <ul>
                            <li>Verificar <code>node.getMainFunction() == null && node.getStatementList() != null</code></li>
                            <li>Generar <code>async function main() { ... }</code></li>
                            <li>Dentro, procesar <code>node.getStatementList().accept(this)</code></li>
                        </ul>
                    </div>
                    <div class="step">
                        <strong>Paso 7:</strong> Agregar la llamada final
                        <ul>
                            <li><code>main().catch(err => console.error('Error:', err));</code></li>
                        </ul>
                    </div>
                </div>

                <div class="hint-box">
                    <div class="hint-title">¬°Simple y Directo!</div>
                    <p>
                        Esta implementaci√≥n es directa: cada m√©todo <code>visit</code> retorna el c√≥digo JavaScript
                        que le corresponde, y <code>visitProgram()</code> simplemente los concatena en el orden correcto.
                    </p>
                    <p>
                        No necesitas buffers intermedios ni variables de estado complejas.
                    </p>
                </div>

                <div class="example-box">
                    <div class="example-title">Ejemplo: Programa v2.0 sin MAIN</div>
                    <p><strong>RoboLang:</strong></p>
                    <pre>UP;
DOWN;
LEFT;</pre>
                    <p><strong>JavaScript generado:</strong></p>
                    <pre>// ============================================
// RoboLang Compiled Program
// Generated by JavaScriptCodeGenerator
// ============================================

const robot = RoboLangRuntime.getRobot();

// Main Entry Point
async function main() {
    await robot.moveUp();
    await robot.moveDown();
    await robot.moveLeft();
}

// Execute
main().catch(err => console.error('Error:', err));</pre>
                </div>

                <div class="example-box">
                    <div class="example-title">Ejemplo: Programa v3.0 con MAIN y FUNCTION</div>
                    <p><strong>RoboLang:</strong></p>
                    <pre>FUNCTION avanzar(pasos) {
    REPEAT pasos { UP; }
}

MAIN {
    avanzar(3);
}</pre>
                    <p><strong>JavaScript generado:</strong></p>
                    <pre>// ============================================
// RoboLang Compiled Program
// Generated by JavaScriptCodeGenerator
// ============================================

const robot = RoboLangRuntime.getRobot();

async function avanzar(pasos) {
    for (let x3k7m2 = 0; x3k7m2 < pasos; x3k7m2++) {
        await robot.moveUp();
    }
}

// Main Entry Point
async function main() {
    await avanzar(3);
}

// Execute
main().catch(err => console.error('Error:', err));</pre>
                </div>
            </div>

            <!-- 5. Statements -->
            <div class="section" id="statements">
                <h2>5. Implementando Statements</h2>

                <p>
                    Los <strong>statements</strong> son construcciones que ejecutan acciones pero no devuelven valores.
                    Ejemplos: REPEAT, IF, WHILE, VAR, asignaciones.
                </p>

                <h3>5.1 visitRepeatStatement() - EJEMPLO COMPLETO</h3>

                <p>Este es el √öNICO m√©todo donde te mostrar√© el c√≥digo completo como referencia:</p>

                <pre>@Override
public String visitRepeatStatement(RepeatStatementNode node) {
    // 1. Generar una variable de loop √∫nica y aleatoria
    String loopVar = getLoopVariable();

    // 2. Obtener el valor del contador (puede ser n√∫mero o identificador)
    String value;
    if (node.getRepeatCount() != null) {
        value = node.getRepeatCount().accept(this);
    } else if (node.getRepeatCountIdentifier() != null) {
        value = node.getRepeatCountIdentifier().accept(this);
    } else {
        value = "0"; // Default fallback
    }

    // 3. Construir el c√≥digo JavaScript
    StringBuilder code = new StringBuilder();

    // Header del for: for (let varName = 0; varName < count; varName++)
    code.append("for (let ").append(loopVar).append(" = 0; ");
    code.append(loopVar).append(" < ").append(value).append("; ");
    code.append(loopVar).append("++) {\n");

    // 4. Generar el cuerpo del loop (aumentar indentaci√≥n)
    indentLevel++;
    String body = node.getStatementBlock().accept(this);
    code.append(body);
    indentLevel--;

    // 5. Cerrar el for
    code.append(indent()).append("}");

    return code.toString();
}</pre>

                <div class="thinking-box">
                    <div class="thinking-title">An√°lisis Detallado de visitRepeatStatement()</div>
                    <ol>
                        <li><strong>¬øPor qu√© variable aleatoria?</strong>
                            <ul>
                                <li>En loops anidados, no podemos usar siempre "i"</li>
                                <li>Ejemplo: <code>REPEAT 3 { REPEAT 2 { ... } }</code> necesita dos variables distintas</li>
                                <li>getLoopVariable() genera nombres √∫nicos como "a1b2c3", "x7k9m2"</li>
                            </ul>
                        </li>
                        <li><strong>¬øPor qu√© dos formas de obtener el contador?</strong>
                            <ul>
                                <li>v1.0: <code>REPEAT 5 { ... }</code> ‚Üí usa node.getRepeatCount()</li>
                                <li>v2.0+: <code>REPEAT veces { ... }</code> ‚Üí usa node.getRepeatCountIdentifier()</li>
                            </ul>
                        </li>
                        <li><strong>¬øPor qu√© aumentar/disminuir indentLevel?</strong>
                            <ul>
                                <li>El cuerpo del loop debe estar indentado</li>
                                <li>Cada statement en el cuerpo llamar√° a indent() para generar los espacios</li>
                            </ul>
                        </li>
                    </ol>
                </div>

                <div class="example-box">
                    <div class="example-title">Ejemplo: REPEAT con n√∫mero</div>
                    <p><strong>RoboLang:</strong> <code>REPEAT 3 { UP; }</code></p>
                    <p><strong>JavaScript:</strong></p>
                    <pre>for (let a1b2c3 = 0; a1b2c3 < 3; a1b2c3++) {
    await robot.moveUp();
}</pre>
                </div>

                <div class="example-box">
                    <div class="example-title">Ejemplo: REPEAT con variable</div>
                    <p><strong>RoboLang:</strong></p>
                    <pre>VAR veces;
veces := 5;
REPEAT veces { RIGHT; }</pre>
                    <p><strong>JavaScript:</strong></p>
                    <pre>let veces;
veces = 5;
for (let p7x2k9 = 0; p7x2k9 < veces; p7x2k9++) {
    await robot.moveRight();
}</pre>
                </div>

                <div class="test-box">
                    <div class="test-title">üß™ Ejecutar Tests de visitRepeatStatement</div>
                    <pre>mvn test -Dtest="JavaScriptCodeGeneratorTest#testRepeatWithNumber"
mvn test -Dtest="JavaScriptCodeGeneratorTest#testRepeatWithVariable"</pre>
                </div>

                <h3>5.2 visitIfStatement() - C√ìMO Implementarlo</h3>

                <div class="thinking-box">
                    <div class="thinking-title">Proceso de Pensamiento</div>
                    <ol>
                        <li><strong>¬øQu√© informaci√≥n tengo?</strong>
                            <ul>
                                <li>IfStatementNode contiene: condition, thenBlock, elseBlock (opcional)</li>
                            </ul>
                        </li>
                        <li><strong>¬øQu√© debo generar?</strong>
                            <ul>
                                <li>Estructura: <code>if (condici√≥n) { ... } else { ... }</code></li>
                            </ul>
                        </li>
                        <li><strong>¬øQu√© hacer con cada parte?</strong>
                            <ul>
                                <li>Condici√≥n: <code>node.getCondition().accept(this)</code> ‚Üí genera expresi√≥n JS</li>
                                <li>Then block: <code>node.getThenBlock().accept(this)</code> ‚Üí genera statements</li>
                                <li>Else block: verificar si existe antes de procesar</li>
                            </ul>
                        </li>
                        <li><strong>¬øC√≥mo manejar la indentaci√≥n?</strong>
                            <ul>
                                <li>Aumentar indentLevel antes de procesar los bloques</li>
                                <li>Disminuir despu√©s</li>
                            </ul>
                        </li>
                    </ol>
                </div>

                <h4>Pasos de Implementaci√≥n:</h4>

                <div class="steps">
                    <div class="step">Crear StringBuilder</div>
                    <div class="step">Generar condici√≥n: <code>String condition = node.getCondition().accept(this);</code></div>
                    <div class="step">Escribir: <code>"if (" + condition + ") {\n"</code></div>
                    <div class="step">Aumentar indentLevel</div>
                    <div class="step">Generar bloque then: <code>node.getThenBlock().accept(this)</code></div>
                    <div class="step">Disminuir indentLevel</div>
                    <div class="step">Verificar si hay ELSE: <code>if (node.getElseBlock() != null)</code></div>
                    <div class="step">Si hay ELSE, escribir: <code>"} else {\n"</code> y repetir proceso de indentaci√≥n</div>
                    <div class="step">Cerrar con <code>indent() + "}"</code></div>
                </div>

                <div class="test-box">
                    <div class="test-title">üß™ Ejecutar Tests de visitIfStatement</div>
                    <pre>mvn test -Dtest="JavaScriptCodeGeneratorTest#testIfWithoutElse"
mvn test -Dtest="JavaScriptCodeGeneratorTest#testIfElse"</pre>
                </div>

                <h3>5.3 visitWhileStatement() - C√ìMO Implementarlo</h3>

                <div class="hint-box">
                    <div class="hint-title">Pista: Casi id√©ntico a IF</div>
                    <p>
                        El WHILE es muy similar al IF, pero:
                    </p>
                    <ul>
                        <li>Usa <code>while</code> en lugar de <code>if</code></li>
                        <li>No tiene bloque else</li>
                        <li>Misma l√≥gica de indentaci√≥n</li>
                    </ul>
                </div>

                <div class="test-box">
                    <div class="test-title">üß™ Ejecutar Tests de visitWhileStatement</div>
                    <pre>mvn test -Dtest="JavaScriptCodeGeneratorTest#testWhileLoop"</pre>
                </div>

                <h3>5.4 visitVariableDeclaration() - C√ìMO Implementarlo</h3>

                <div class="thinking-box">
                    <div class="thinking-title">An√°lisis</div>
                    <p><strong>RoboLang:</strong> <code>VAR contador;</code></p>
                    <p><strong>JavaScript:</strong> <code>let contador;</code></p>
                    <p>
                        Es muy simple: solo necesitas obtener el nombre de la variable y anteponer <code>let</code>.
                    </p>
                    <p>
                        <strong>Pasos:</strong>
                    </p>
                    <ol>
                        <li>Obtener el nombre: <code>String varName = node.getIdentifier().accept(this);</code></li>
                        <li>Retornar: <code>"let " + varName + ";"</code></li>
                    </ol>
                </div>

                <div class="test-box">
                    <div class="test-title">üß™ Ejecutar Tests de visitVariableDeclaration</div>
                    <pre>mvn test -Dtest="JavaScriptCodeGeneratorTest#testVariableDeclaration"</pre>
                </div>

                <h3>5.5 visitAssignment() - C√ìMO Implementarlo</h3>

                <div class="thinking-box">
                    <div class="thinking-title">An√°lisis</div>
                    <p><strong>RoboLang:</strong> <code>contador := 5;</code></p>
                    <p><strong>JavaScript:</strong> <code>contador = 5;</code></p>
                    <p>
                        <strong>Pasos:</strong>
                    </p>
                    <ol>
                        <li>Obtener el identificador: <code>node.getIdentifier().accept(this)</code></li>
                        <li>Obtener el valor: <code>node.getValue().accept(this)</code></li>
                        <li>Retornar: <code>varName + " = " + value + ";"</code></li>
                    </ol>
                    <p>
                        Nota: El operador <code>:=</code> de RoboLang se convierte en <code>=</code> de JavaScript.
                    </p>
                </div>

                <div class="test-box">
                    <div class="test-title">üß™ Ejecutar Tests de visitAssignment</div>
                    <pre>mvn test -Dtest="JavaScriptCodeGeneratorTest#testVariableAssignmentWithNumber"
mvn test -Dtest="JavaScriptCodeGeneratorTest#testVariableAssignmentWithSensor"
mvn test -Dtest="JavaScriptCodeGeneratorTest#testVariableAssignmentWithBoolean"</pre>
                </div>

                <h3>5.6 visitStatementList() - C√ìMO Implementarlo</h3>

                <div class="thinking-box">
                    <div class="thinking-title">An√°lisis</div>
                    <p>
                        Un StatementList contiene una lista de statements. Debes:
                    </p>
                    <ol>
                        <li>Recorrer <code>node.getStatements()</code> con un for</li>
                        <li>Para cada statement, llamar <code>statement.accept(this)</code></li>
                        <li>Agregar indentaci√≥n antes de cada statement</li>
                        <li>Agregar un salto de l√≠nea despu√©s de cada statement</li>
                    </ol>
                </div>

                <div class="warning-box">
                    <div class="warning-title">Cuidado con la Indentaci√≥n</div>
                    <p>
                        En visitStatementList(), debes llamar a <code>indent()</code> antes de cada statement.
                        No aumentes/disminuyas indentLevel aqu√≠, eso lo hacen los padres (IF, WHILE, REPEAT, etc.)
                    </p>
                </div>
            </div>

            <!-- 6. Commands -->
            <div class="section" id="commands">
                <h2>6. Implementando Commands</h2>

                <p>
                    Los <strong>commands</strong> son las acciones b√°sicas del robot: UP, DOWN, LEFT, RIGHT, PENUP, PENDOWN.
                </p>

                <h3>6.1 visitMovementCommand() - C√ìMO Implementarlo</h3>

                <div class="thinking-box">
                    <div class="thinking-title">An√°lisis</div>
                    <p>
                        Cada comando de movimiento debe traducirse a una llamada a la API del robot.
                    </p>
                    <table>
                        <tr>
                            <th>RoboLang</th>
                            <th>JavaScript</th>
                            <th>¬øasync/await?</th>
                        </tr>
                        <tr>
                            <td>UP</td>
                            <td>await robot.moveUp();</td>
                            <td>‚úÖ S√ç (animaci√≥n)</td>
                        </tr>
                        <tr>
                            <td>DOWN</td>
                            <td>await robot.moveDown();</td>
                            <td>‚úÖ S√ç (animaci√≥n)</td>
                        </tr>
                        <tr>
                            <td>LEFT</td>
                            <td>await robot.moveLeft();</td>
                            <td>‚úÖ S√ç (animaci√≥n)</td>
                        </tr>
                        <tr>
                            <td>RIGHT</td>
                            <td>await robot.moveRight();</td>
                            <td>‚úÖ S√ç (animaci√≥n)</td>
                        </tr>
                    </table>
                </div>

                <h4>Pasos de Implementaci√≥n:</h4>

                <div class="steps">
                    <div class="step">Obtener el tipo de comando: <code>TokenType type = node.getCommandType();</code></div>
                    <div class="step">Usar un switch para mapear cada tipo a su m√©todo correspondiente</div>
                    <div class="step">Todos los movimientos llevan <code>await</code></div>
                    <div class="step">Incluir un caso default por si aparece un comando desconocido</div>
                </div>

                <div class="test-box">
                    <div class="test-title">üß™ Ejecutar Tests de visitMovementCommand</div>
                    <pre>mvn test -Dtest="JavaScriptCodeGeneratorTest#testBasicMovementCommands"</pre>
                </div>

                <h3>6.2 visitPenCommand() - C√ìMO Implementarlo</h3>

                <div class="thinking-box">
                    <div class="thinking-title">An√°lisis</div>
                    <table>
                        <tr>
                            <th>RoboLang</th>
                            <th>JavaScript</th>
                            <th>¬øasync/await?</th>
                        </tr>
                        <tr>
                            <td>PENUP</td>
                            <td>robot.penUp();</td>
                            <td>‚ùå NO (instant√°neo)</td>
                        </tr>
                        <tr>
                            <td>PENDOWN</td>
                            <td>robot.penDown();</td>
                            <td>‚ùå NO (instant√°neo)</td>
                        </tr>
                    </table>
                </div>

                <div class="warning-box">
                    <div class="warning-title">IMPORTANTE: Sin await</div>
                    <p>
                        Los comandos de pluma (PENUP/PENDOWN) NO llevan <code>await</code> porque son instant√°neos.
                        Solo los movimientos llevan await porque tienen animaci√≥n.
                    </p>
                </div>

                <h4>Implementaci√≥n:</h4>
                <p>Muy similar a visitMovementCommand(), pero sin <code>await</code>.</p>

                <div class="test-box">
                    <div class="test-title">üß™ Ejecutar Tests de visitPenCommand</div>
                    <pre>mvn test -Dtest="JavaScriptCodeGeneratorTest#testPenCommands"</pre>
                </div>
            </div>

            <!-- 7. Expressions -->
            <div class="section" id="expressions">
                <h2>7. Implementando Expressions</h2>

                <p>
                    Las <strong>expresiones</strong> son construcciones que eval√∫an a un valor. Se usan en condiciones de IF y WHILE.
                </p>

                <h3>Jerarqu√≠a de Expresiones (por precedencia)</h3>

                <table>
                    <tr>
                        <th>Nivel</th>
                        <th>Operador</th>
                        <th>Ejemplo RoboLang</th>
                    </tr>
                    <tr>
                        <td>1. M√°s baja</td>
                        <td>OR</td>
                        <td>a = 1 OR b = 2</td>
                    </tr>
                    <tr>
                        <td>2.</td>
                        <td>AND</td>
                        <td>a = 1 AND b = 2</td>
                    </tr>
                    <tr>
                        <td>3.</td>
                        <td>NOT</td>
                        <td>NOT a = 1</td>
                    </tr>
                    <tr>
                        <td>4. M√°s alta</td>
                        <td>Comparaci√≥n</td>
                        <td>a = 1, b != 2, c < 3</td>
                    </tr>
                </table>

                <h3>7.1 visitOrExpression() - C√ìMO Implementarlo</h3>

                <div class="thinking-box">
                    <div class="thinking-title">An√°lisis</div>
                    <p>
                        Un OrExpression contiene una lista de AndExpressions separadas por OR.
                    </p>
                    <p><strong>Ejemplo:</strong> <code>a = 1 OR b = 2 OR c = 3</code></p>
                    <p>Esto se parsea como: <code>OrExpression([AndExpr1, AndExpr2, AndExpr3])</code></p>
                </div>

                <h4>Pasos de Implementaci√≥n:</h4>

                <div class="steps">
                    <div class="step">Obtener la lista: <code>List&lt;AndExpressionNode&gt; andExprs = node.getAndExpressions();</code></div>
                    <div class="step"><strong>Caso especial:</strong> Si la lista tiene solo 1 elemento, no necesitas OR
                        <ul><li>Retornar directamente: <code>andExprs.get(0).accept(this)</code></li></ul>
                    </div>
                    <div class="step">Si hay m√∫ltiples elementos, recorrer la lista con un for</div>
                    <div class="step">Para cada elemento, llamar <code>accept(this)</code> y agregar <code>" || "</code> entre ellos</div>
                    <div class="step">Cuidado con no agregar || despu√©s del √∫ltimo elemento</div>
                </div>

                <div class="test-box">
                    <div class="test-title">üß™ Ejecutar Tests de visitOrExpression</div>
                    <pre>mvn test -Dtest="JavaScriptCodeGeneratorTest#testOrOperator"</pre>
                </div>

                <h3>7.2 visitAndExpression() - C√ìMO Implementarlo</h3>

                <div class="hint-box">
                    <div class="hint-title">Pista</div>
                    <p>
                        Casi id√©ntico a visitOrExpression(), pero:
                    </p>
                    <ul>
                        <li>Trabaja con NotExpressions en lugar de AndExpressions</li>
                        <li>Usa <code>" && "</code> en lugar de <code>" || "</code></li>
                    </ul>
                </div>

                <div class="test-box">
                    <div class="test-title">üß™ Ejecutar Tests de visitAndExpression</div>
                    <pre>mvn test -Dtest="JavaScriptCodeGeneratorTest#testAndOperator"</pre>
                </div>

                <h3>7.3 visitNotExpression() - C√ìMO Implementarlo</h3>

                <div class="thinking-box">
                    <div class="thinking-title">An√°lisis</div>
                    <p>
                        Un NotExpression puede estar negado o no.
                    </p>
                    <p><strong>Ejemplo 1:</strong> <code>NOT a = 1</code> ‚Üí isNegated = true</p>
                    <p><strong>Ejemplo 2:</strong> <code>a = 1</code> ‚Üí isNegated = false</p>
                </div>

                <h4>Pasos de Implementaci√≥n:</h4>

                <div class="steps">
                    <div class="step">Generar la expresi√≥n interna: <code>String expr = node.getExpression().accept(this);</code></div>
                    <div class="step">Verificar: <code>if (node.isNegated())</code></div>
                    <div class="step">Si est√° negado: <code>return "!(" + expr + ")";</code></div>
                    <div class="step">Si no est√° negado: <code>return expr;</code></div>
                </div>

                <div class="test-box">
                    <div class="test-title">üß™ Ejecutar Tests de visitNotExpression</div>
                    <pre>mvn test -Dtest="JavaScriptCodeGeneratorTest#testNotOperator"</pre>
                </div>

                <h3>7.4 visitComparisonExpression() - C√ìMO Implementarlo</h3>

                <div class="thinking-box">
                    <div class="thinking-title">An√°lisis</div>
                    <p>
                        Una comparaci√≥n tiene tres partes: izquierda, operador, derecha.
                    </p>
                    <p><strong>Ejemplo:</strong> <code>temperatura > 25</code></p>
                    <ul>
                        <li>Izquierda: temperatura (identificador)</li>
                        <li>Operador: > (mayor que)</li>
                        <li>Derecha: 25 (n√∫mero)</li>
                    </ul>
                </div>

                <h4>Pasos de Implementaci√≥n:</h4>

                <div class="steps">
                    <div class="step">Obtener izquierda: <code>String left = node.getLeftValue().accept(this);</code></div>
                    <div class="step">Obtener operador: <code>String op = node.getOperator().accept(this);</code></div>
                    <div class="step">Obtener derecha: <code>String right = node.getRightValue().accept(this);</code></div>
                    <div class="step">Retornar: <code>left + " " + op + " " + right</code></div>
                </div>

                <div class="test-box">
                    <div class="test-title">üß™ Ejecutar Tests de visitComparisonExpression</div>
                    <pre>mvn test -Dtest="JavaScriptCodeGeneratorTest#testComparisonExpressions"</pre>
                </div>

                <h3>7.5 visitComparisonOperator() - C√ìMO Implementarlo</h3>

                <div class="warning-box">
                    <div class="warning-title">CR√çTICO: Conversi√≥n de Operadores</div>
                    <table>
                        <tr>
                            <th>RoboLang</th>
                            <th>JavaScript</th>
                            <th>Raz√≥n</th>
                        </tr>
                        <tr>
                            <td>=</td>
                            <td>===</td>
                            <td>JavaScript tiene igualdad estricta</td>
                        </tr>
                        <tr>
                            <td>!=</td>
                            <td>!==</td>
                            <td>Desigualdad estricta</td>
                        </tr>
                        <tr>
                            <td>&lt;, &lt;=, &gt;, &gt;=</td>
                            <td>&lt;, &lt;=, &gt;, &gt;=</td>
                            <td>Iguales en ambos lenguajes</td>
                        </tr>
                    </table>
                </div>

                <h4>Implementaci√≥n:</h4>

                <div class="steps">
                    <div class="step">Obtener el operador: <code>String op = node.getOperator();</code></div>
                    <div class="step">Si es "=", retornar "==="</div>
                    <div class="step">Si es "!=", retornar "!=="</div>
                    <div class="step">Para los dem√°s, retornar sin cambios</div>
                </div>

                <div class="test-box">
                    <div class="test-title">üß™ Ejecutar Tests de visitComparisonOperator</div>
                    <pre>mvn test -Dtest="JavaScriptCodeGeneratorTest#testComparisonExpressions"</pre>
                </div>
            </div>

            <!-- 8. Values y Literals -->
            <div class="section" id="values">
                <h2>8. Implementando Values y Literals</h2>

                <p>
                    Los <strong>values</strong> y <strong>literals</strong> son los elementos m√°s b√°sicos: n√∫meros, booleanos, identificadores, sensores.
                </p>

                <h3>8.1 visitNumber() - C√ìMO Implementarlo</h3>

                <div class="thinking-box">
                    <div class="thinking-title">An√°lisis</div>
                    <p>
                        Un n√∫mero en RoboLang debe convertirse a su representaci√≥n en JavaScript.
                    </p>
                    <p><strong>Ejemplo:</strong> <code>42</code> ‚Üí <code>"42"</code></p>
                </div>

                <h4>Implementaci√≥n:</h4>
                <p>Muy simple: <code>return String.valueOf(node.getValue());</code></p>

                <div class="test-box">
                    <div class="test-title">üß™ Ejecutar Tests de visitNumber</div>
                    <pre>mvn test -Dtest="JavaScriptCodeGeneratorTest#testRepeatWithNumber"</pre>
                </div>

                <h3>8.2 visitBoolean() - C√ìMO Implementarlo</h3>

                <p>Id√©ntico a visitNumber(): <code>return String.valueOf(node.getValue());</code></p>
                <p>Los booleanos true/false son iguales en RoboLang y JavaScript.</p>

                <div class="test-box">
                    <div class="test-title">üß™ Ejecutar Tests de visitBoolean</div>
                    <pre>mvn test -Dtest="JavaScriptCodeGeneratorTest#testVariableAssignmentWithBoolean"
mvn test -Dtest="JavaScriptCodeGeneratorTest#testReturnStatementWithBoolean"</pre>
                </div>

                <h3>8.3 visitIdentifier() - C√ìMO Implementarlo</h3>

                <p>Los identificadores (nombres de variables) son iguales en ambos lenguajes.</p>
                <p><strong>Implementaci√≥n:</strong> <code>return node.getName();</code></p>

                <div class="test-box">
                    <div class="test-title">üß™ Ejecutar Tests de visitIdentifier</div>
                    <pre>mvn test -Dtest="JavaScriptCodeGeneratorTest#testRepeatWithVariable"</pre>
                </div>

                <h3>8.4 visitNumericSensor() - C√ìMO Implementarlo</h3>

                <div class="thinking-box">
                    <div class="thinking-title">An√°lisis</div>
                    <p>
                        Los sensores num√©ricos (DIST, TEMP, LIGHT, BATTERY) deben convertirse a llamadas a la API.
                    </p>
                    <table>
                        <tr>
                            <th>RoboLang</th>
                            <th>JavaScript</th>
                        </tr>
                        <tr>
                            <td>DIST</td>
                            <td>robot.getSensor('DIST')</td>
                        </tr>
                        <tr>
                            <td>TEMP</td>
                            <td>robot.getSensor('TEMP')</td>
                        </tr>
                        <tr>
                            <td>LIGHT</td>
                            <td>robot.getSensor('LIGHT')</td>
                        </tr>
                        <tr>
                            <td>BATTERY</td>
                            <td>robot.getSensor('BATTERY')</td>
                        </tr>
                    </table>
                </div>

                <h4>Implementaci√≥n:</h4>
                <div class="steps">
                    <div class="step">Obtener el nombre del sensor: <code>String sensorName = node.getSensor();</code></div>
                    <div class="step">Retornar: <code>"robot.getSensor('" + sensorName + "')"</code></div>
                </div>

                <div class="warning-box">
                    <div class="warning-title">IMPORTANTE: Comillas</div>
                    <p>
                        El nombre del sensor debe estar entre comillas simples en JavaScript:
                        <code>'DIST'</code>, no <code>DIST</code> (sin comillas).
                    </p>
                </div>

                <div class="test-box">
                    <div class="test-title">üß™ Ejecutar Tests de visitNumericSensor</div>
                    <pre>mvn test -Dtest="JavaScriptCodeGeneratorTest#testNumericSensors"</pre>
                </div>

                <h3>8.5 visitBooleanSensor() - C√ìMO Implementarlo</h3>

                <p>Id√©ntico a visitNumericSensor(). El sensor OBSTACLE se maneja igual:</p>
                <p><code>OBSTACLE</code> ‚Üí <code>robot.getSensor('OBSTACLE')</code></p>

                <div class="test-box">
                    <div class="test-title">üß™ Ejecutar Tests de visitBooleanSensor</div>
                    <pre>mvn test -Dtest="JavaScriptCodeGeneratorTest#testBooleanSensor"</pre>
                </div>
            </div>

            <!-- 9. Funciones v3.0 -->
            <div class="section" id="functions">
                <h2>9. Implementando Funciones (v3.0)</h2>

                <p>
                    Las funciones son una caracter√≠stica de RoboLang v3.0. Permiten definir bloques de c√≥digo reutilizables.
                </p>

                <h3>9.1 visitFunctionDeclaration() - C√ìMO Implementarlo</h3>

                <div class="thinking-box">
                    <div class="thinking-title">An√°lisis</div>
                    <p><strong>RoboLang:</strong></p>
                    <pre>FUNCTION cuadrado(lado) {
    REPEAT lado {
        UP;
        RIGHT;
    }
}</pre>
                    <p><strong>JavaScript:</strong></p>
                    <pre>async function cuadrado(lado) {
    for (let x7k2m3 = 0; x7k2m3 < lado; x7k2m3++) {
        await robot.moveUp();
        await robot.moveRight();
    }
}

</pre>
                </div>

                <h4>Puntos Clave:</h4>

                <ul>
                    <li>Todas las funciones RoboLang deben ser <code>async</code> en JavaScript</li>
                    <li>Los par√°metros se copian tal cual</li>
                    <li>El cuerpo se procesa con accept()</li>
                    <li>Retornar el c√≥digo generado directamente</li>
                </ul>

                <h4>Pasos de Implementaci√≥n:</h4>

                <div class="steps">
                    <div class="step">Crear StringBuilder</div>
                    <div class="step">Escribir: <code>"async function " + node.getFunctionName() + "("</code></div>
                    <div class="step">Recorrer los par√°metros con un for, separ√°ndolos con comas</div>
                    <div class="step">Cerrar par√©ntesis: <code>") {\n"</code></div>
                    <div class="step">Aumentar indentLevel</div>
                    <div class="step">Generar el cuerpo: <code>node.getBody().accept(this)</code></div>
                    <div class="step">Disminuir indentLevel</div>
                    <div class="step">Cerrar: <code>"}\n\n"</code></div>
                    <div class="step">Retornar el c√≥digo completo: <code>return code.toString();</code></div>
                </div>

                <div class="hint-box">
                    <div class="hint-title">Simple y Directo</div>
                    <p>
                        Este m√©todo retorna directamente el c√≥digo JavaScript de la funci√≥n completa.
                        <code>visitProgram()</code> se encargar√° de concatenar todas las funciones en el orden correcto.
                    </p>
                </div>

                <div class="test-box">
                    <div class="test-title">üß™ Ejecutar Tests de visitFunctionDeclaration</div>
                    <pre>mvn test -Dtest="JavaScriptCodeGeneratorTest#testFunctionDeclarationWithoutParameters"
mvn test -Dtest="JavaScriptCodeGeneratorTest#testFunctionDeclarationWithOneParameter"
mvn test -Dtest="JavaScriptCodeGeneratorTest#testFunctionDeclarationWithMultipleParameters"</pre>
                </div>

                <h3>9.2 visitMainFunction() - C√ìMO Implementarlo</h3>

                <div class="hint-box">
                    <div class="hint-title">Pista</div>
                    <p>
                        Muy similar a visitFunctionDeclaration(), pero:
                    </p>
                    <ul>
                        <li>El nombre siempre es "main"</li>
                        <li>No tiene par√°metros</li>
                        <li>Agregar comentario antes: <code>"// Main Entry Point\n"</code></li>
                        <li>Retornar el c√≥digo generado</li>
                    </ul>
                    <p style="margin-top: 10px;">
                        <strong>Estructura:</strong><br>
                        <code>// Main Entry Point\nasync function main() { ... }\n\n</code>
                    </p>
                </div>

                <div class="test-box">
                    <div class="test-title">üß™ Ejecutar Tests de visitMainFunction</div>
                    <pre>mvn test -Dtest="JavaScriptCodeGeneratorTest#testMainFunctionWithSimpleCommands"
mvn test -Dtest="JavaScriptCodeGeneratorTest#testMainFunctionWithVariablesAndLogic"</pre>
                </div>

                <h3>9.3 visitFunctionCall() - C√ìMO Implementarlo</h3>

                <div class="thinking-box">
                    <div class="thinking-title">An√°lisis</div>
                    <p><strong>RoboLang:</strong> <code>cuadrado(5);</code></p>
                    <p><strong>JavaScript:</strong> <code>await cuadrado(5);</code></p>
                </div>

                <h4>Pasos de Implementaci√≥n:</h4>

                <div class="steps">
                    <div class="step">Escribir: <code>"await " + node.getFunctionName() + "("</code></div>
                    <div class="step">Recorrer los argumentos, procesarlos con accept(), separar con comas</div>
                    <div class="step">Cerrar: <code>");"</code></div>
                </div>

                <div class="warning-box">
                    <div class="warning-title">IMPORTANTE: await</div>
                    <p>
                        Todas las llamadas a funciones deben llevar <code>await</code> porque las funciones son async
                        y pueden contener movimientos.
                    </p>
                </div>

                <div class="test-box">
                    <div class="test-title">üß™ Ejecutar Tests de visitFunctionCall</div>
                    <pre>mvn test -Dtest="JavaScriptCodeGeneratorTest#testFunctionCallWithoutArguments"
mvn test -Dtest="JavaScriptCodeGeneratorTest#testFunctionCallWithOneArgument"
mvn test -Dtest="JavaScriptCodeGeneratorTest#testFunctionCallWithMultipleArguments"</pre>
                </div>

                <h3>9.4 visitReturnStatement() - C√ìMO Implementarlo</h3>

                <div class="thinking-box">
                    <div class="thinking-title">An√°lisis</div>
                    <p>
                        Hay dos casos:
                    </p>
                    <ol>
                        <li><strong>RETURN con valor:</strong> <code>RETURN x;</code> ‚Üí <code>return x;</code></li>
                        <li><strong>RETURN sin valor:</strong> <code>RETURN;</code> ‚Üí <code>return;</code></li>
                    </ol>
                </div>

                <h4>Implementaci√≥n:</h4>

                <div class="steps">
                    <div class="step">Verificar: <code>if (node.hasReturnValue())</code></div>
                    <div class="step">Si hay valor, obtenerlo: <code>node.getReturnValue().accept(this)</code></div>
                    <div class="step">Retornar: <code>"return " + value + ";"</code></div>
                    <div class="step">Si no hay valor, retornar: <code>"return;"</code></div>
                </div>

                <div class="test-box">
                    <div class="test-title">üß™ Ejecutar Tests de visitReturnStatement</div>
                    <pre>mvn test -Dtest="JavaScriptCodeGeneratorTest#testReturnStatementWithoutValue"
mvn test -Dtest="JavaScriptCodeGeneratorTest#testReturnStatementWithNumber"
mvn test -Dtest="JavaScriptCodeGeneratorTest#testReturnStatementWithIdentifier"
mvn test -Dtest="JavaScriptCodeGeneratorTest#testReturnStatementWithBoolean"</pre>
                </div>

                <h3>9.5 visitParameter() - C√ìMO Implementarlo</h3>

                <p>Muy simple: <code>return node.getName();</code></p>
                <p>Los par√°metros son nombres que se copian tal cual a JavaScript.</p>

                <div class="test-box">
                    <div class="test-title">üß™ Ejecutar Tests de visitParameter</div>
                    <pre>mvn test -Dtest="JavaScriptCodeGeneratorTest#testParameterGeneration"</pre>
                </div>
            </div>

            <!-- 10. Helpers -->
            <div class="section" id="helpers">
                <h2>10. M√©todos Helper: Indentaci√≥n y Variables Aleatorias</h2>

                <p>
                    Los <strong>helpers</strong> son m√©todos auxiliares que no son parte del visitor pero son esenciales
                    para generar c√≥digo correcto.
                </p>

                <h3>10.1 indent() - Generar Espacios de Indentaci√≥n</h3>

                <div class="thinking-box">
                    <div class="thinking-title">Prop√≥sito</div>
                    <p>
                        Generar una cadena con espacios seg√∫n el nivel de indentaci√≥n actual.
                    </p>
                    <p><strong>Ejemplo:</strong> Si <code>indentLevel = 2</code>, retornar "        " (8 espacios)</p>
                </div>

                <h4>Implementaci√≥n:</h4>

                <pre>private String indent() {
    return "    ".repeat(Math.max(0, indentLevel));
}</pre>

                <p>Usamos 4 espacios por nivel de indentaci√≥n.</p>

                <h3>10.2 generateRandomVariableName() - Variables Aleatorias para Loops</h3>

                <div class="thinking-box">
                    <div class="thinking-title">¬øPor qu√© variables aleatorias?</div>
                    <p>
                        En loops anidados, no podemos reutilizar el mismo nombre de variable:
                    </p>
                    <pre>REPEAT 3 {
    REPEAT 2 {
        UP;
    }
}</pre>
                    <p>Si usamos siempre "i", tendr√≠amos:</p>
                    <pre>for (let i = 0; i < 3; i++) {
    for (let i = 0; i < 2; i++) {  // ‚ùå Error: 'i' ya est√° declarado
        await robot.moveUp();
    }
}</pre>
                    <p>Con variables aleatorias:</p>
                    <pre>for (let a1b2c3 = 0; a1b2c3 < 3; a1b2c3++) {
    for (let x7k9m2 = 0; x7k9m2 < 2; x7k9m2++) {  // ‚úÖ Correcto
        await robot.moveUp();
    }
}</pre>
                </div>

                <h4>Formato de las Variables</h4>

                <p>Las variables tienen el formato: <strong>letra + 5 caracteres alfanum√©ricos</strong></p>
                <p>Ejemplos: <code>a1b2c3</code>, <code>p7x2k9</code>, <code>z4m8n1</code></p>

                <h4>Pasos de Implementaci√≥n:</h4>

                <div class="steps">
                    <div class="step">Crear un StringBuilder</div>
                    <div class="step">Primer car√°cter: letra min√∫scula aleatoria (a-z)</div>
                    <div class="step">Siguientes 5 caracteres: letra min√∫scula o d√≠gito aleatorio</div>
                    <div class="step">Verificar si el nombre ya fue usado (en usedVariableNames)</div>
                    <div class="step">Si ya existe, generar otro (m√°ximo 100 intentos)</div>
                    <div class="step">Agregar a usedVariableNames</div>
                    <div class="step">Retornar el nombre</div>
                </div>

                <h3>10.3 reset() - Limpiar Estado entre Compilaciones</h3>

                <div class="warning-box">
                    <div class="warning-title">CR√çTICO</div>
                    <p>
                        Si no reseteas el estado, compilar m√∫ltiples programas dar√° resultados incorrectos.
                    </p>
                </div>

                <h4>Qu√© resetear:</h4>

                <ul>
                    <li><code>indentLevel</code> ‚Üí 0</li>
                    <li><code>usedVariableNames</code> ‚Üí clear()</li>
                </ul>

                <p>El m√©todo reset() se llama autom√°ticamente en generate() al inicio.</p>

                <div class="hint-box">
                    <div class="hint-title">¬°Eso es todo!</div>
                    <p>
                        Solo necesitas resetear 2 cosas. Mantener el c√≥digo simple hace que sea m√°s f√°cil
                        de entender y menos propenso a errores.
                    </p>
                </div>
            </div>

            <!-- 11. Checklist -->
            <div class="section" id="checklist">
                <h2>11. Checklist de Implementaci√≥n</h2>

                <p>
                    Usa esta lista para verificar que tu implementaci√≥n est√° completa.
                </p>

                <h3>Estructura B√°sica</h3>

                <ul>
                    <li>‚úÖ Clase JavaScriptCodeGenerator implementa ASTVisitor&lt;String&gt;</li>
                    <li>‚úÖ Variables de estado declaradas (indentLevel, random, usedVariableNames, etc.)</li>
                    <li>‚úÖ Constructor inicializa todas las variables</li>
                    <li>‚úÖ M√©todo generate() resetea estado y llama a program.accept(this)</li>
                    <li>‚úÖ M√©todo reset() limpia todas las variables</li>
                </ul>

                <h3>Program y Estructura</h3>

                <ul>
                    <li>‚úÖ visitProgram() genera header completo</li>
                    <li>‚úÖ visitProgram() genera <code>const robot = RoboLangRuntime.getRobot();</code></li>
                    <li>‚úÖ visitProgram() procesa funciones y las concatena directamente</li>
                    <li>‚úÖ visitProgram() procesa MAIN (si existe)</li>
                    <li>‚úÖ visitProgram() crea main() autom√°tico si no hay MAIN expl√≠cito</li>
                    <li>‚úÖ visitProgram() genera llamada final a main()</li>
                </ul>

                <h3>Statements (8 m√©todos)</h3>

                <ul>
                    <li>‚úÖ visitStatement() delega al statement interno</li>
                    <li>‚úÖ visitStatementList() recorre statements con indentaci√≥n</li>
                    <li>‚úÖ visitStatementBlock() delega al statementList interno</li>
                    <li>‚úÖ visitRepeatStatement() genera for con variable aleatoria</li>
                    <li>‚úÖ visitIfStatement() genera if/else con indentaci√≥n correcta</li>
                    <li>‚úÖ visitWhileStatement() genera while con indentaci√≥n correcta</li>
                    <li>‚úÖ visitVariableDeclaration() genera <code>let varName;</code></li>
                    <li>‚úÖ visitAssignment() genera <code>varName = value;</code></li>
                </ul>

                <h3>Funciones v3.0 (5 m√©todos)</h3>

                <ul>
                    <li>‚úÖ visitFunctionDeclaration() genera async function completa</li>
                    <li>‚úÖ visitFunctionDeclaration() retorna el c√≥digo directamente</li>
                    <li>‚úÖ visitMainFunction() genera main() completa</li>
                    <li>‚úÖ visitMainFunction() retorna el c√≥digo directamente</li>
                    <li>‚úÖ visitParameter() retorna el nombre del par√°metro</li>
                    <li>‚úÖ visitReturnStatement() genera return con/sin valor</li>
                    <li>‚úÖ visitFunctionCall() genera <code>await functionName(args);</code></li>
                </ul>

                <h3>Commands (3 m√©todos)</h3>

                <ul>
                    <li>‚úÖ visitSimpleCommand() delega al comando interno</li>
                    <li>‚úÖ visitMovementCommand() mapea UP/DOWN/LEFT/RIGHT con await</li>
                    <li>‚úÖ visitPenCommand() mapea PENUP/PENDOWN sin await</li>
                </ul>

                <h3>Expressions (7 m√©todos)</h3>

                <ul>
                    <li>‚úÖ visitCondition() delega a OrExpression</li>
                    <li>‚úÖ visitOrExpression() une expresiones con ||</li>
                    <li>‚úÖ visitAndExpression() une expresiones con &&</li>
                    <li>‚úÖ visitNotExpression() agrega ! si est√° negado</li>
                    <li>‚úÖ visitPrimaryExpression() agrega par√©ntesis si est√° parentizada</li>
                    <li>‚úÖ visitComparisonExpression() genera left op right</li>
                    <li>‚úÖ visitComparisonOperator() convierte = a === y != a !==</li>
                </ul>

                <h3>Values y Literals (8 m√©todos)</h3>

                <ul>
                    <li>‚úÖ visitValue() delega al valor interno</li>
                    <li>‚úÖ visitSensor() delega al sensor interno</li>
                    <li>‚úÖ visitNumericSensor() genera <code>robot.getSensor('NOMBRE')</code></li>
                    <li>‚úÖ visitBooleanSensor() genera <code>robot.getSensor('OBSTACLE')</code></li>
                    <li>‚úÖ visitNumber() retorna String.valueOf(node.getValue())</li>
                    <li>‚úÖ visitDigit() retorna String.valueOf(node.getValue())</li>
                    <li>‚úÖ visitBoolean() retorna String.valueOf(node.getValue())</li>
                    <li>‚úÖ visitIdentifier() retorna node.getName()</li>
                </ul>

                <h3>Helpers (2 m√©todos)</h3>

                <ul>
                    <li>‚úÖ indent() genera espacios seg√∫n indentLevel</li>
                    <li>‚úÖ generateRandomVariableName() genera nombres √∫nicos</li>
                </ul>

                <h3>Detalles Importantes</h3>

                <ul>
                    <li>‚úÖ Movimientos usan <code>await</code></li>
                    <li>‚úÖ Comandos de pluma NO usan <code>await</code></li>
                    <li>‚úÖ Funciones son <code>async</code></li>
                    <li>‚úÖ Llamadas a funciones usan <code>await</code></li>
                    <li>‚úÖ Variables de loop son aleatorias y √∫nicas</li>
                    <li>‚úÖ Operador = se convierte a ===</li>
                    <li>‚úÖ Operador != se convierte a !==</li>
                    <li>‚úÖ Sensores llevan comillas: <code>'DIST'</code></li>
                    <li>‚úÖ Indentaci√≥n se maneja correctamente en todos los bloques</li>
                    <li>‚úÖ Estado se resetea antes de cada generaci√≥n</li>
                </ul>

                <h3>Testing</h3>

                <ul>
                    <li>‚úÖ Programa simple v2.0 (sin MAIN)</li>
                    <li>‚úÖ Programa v3.0 (con MAIN y FUNCTION)</li>
                    <li>‚úÖ Programa con REPEAT</li>
                    <li>‚úÖ Programa con IF/ELSE</li>
                    <li>‚úÖ Programa con WHILE</li>
                    <li>‚úÖ Programa con variables</li>
                    <li>‚úÖ Programa con sensores</li>
                    <li>‚úÖ Programa con expresiones l√≥gicas (AND, OR, NOT)</li>
                    <li>‚úÖ Programa con loops anidados</li>
                    <li>‚úÖ Programa con funciones y par√°metros</li>
                </ul>

                <div class="example-box">
                    <div class="example-title">¬°Felicitaciones!</div>
                    <p>
                        Si has completado todos los puntos del checklist, tu implementaci√≥n del
                        JavaScriptCodeGenerator est√° completa y lista para generar c√≥digo JavaScript
                        ejecutable a partir de programas RoboLang.
                    </p>
                    <p style="margin-top: 20px; text-align: center; font-size: 1.2em;">
                        <strong>üéâ Has construido un transpilador completo üéâ</strong>
                    </p>
                </div>
            </div>

            <!-- Footer -->
            <div style="margin-top: 40px; padding: 20px; background: #f8f9fa; border-radius: 10px; text-align: center;">
                <p style="color: #1e3c72; font-weight: bold; font-size: 1.2em;">
                    Recuerda: Esta gu√≠a te ense√±a C√ìMO pensar el problema
                </p>
                <p style="color: #666; margin-top: 10px;">
                    El verdadero aprendizaje viene de implementarlo t√∫ mismo, entendiendo cada decisi√≥n.
                    No copies c√≥digo, entiende el PROCESO.
                </p>
            </div>
        </div>
    </div>
</body>
</html>
